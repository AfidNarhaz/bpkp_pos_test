plugins {
    id "com.android.application"
    id "kotlin-android"
    // The Flutter Gradle Plugin must be applied after the Android and Kotlin Gradle plugins.
    id "dev.flutter.flutter-gradle-plugin"
}

android {
    namespace = "com.example.bpkp_pos_test"
    compileSdk = 36 // Pastikan compileSdk sesuai dengan versi Android terbaru
    ndkVersion = "29.0.13599879"

    defaultConfig {
        applicationId = "com.example.bpkp_pos_test"
        minSdkVersion flutter.minSdkVersion // Minimal versi Android (ubah sesuai kebutuhan)
        targetSdk = 36 // Target SDK sesuai dengan compileSdk
        versionCode = flutter.versionCode
        versionName = flutter.versionName

        multiDexEnabled true

        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a", "x86_64"
        }

        // Konfigurasi untuk mendukung kamera dan penyimpanan
        vectorDrawables {
            useSupportLibrary = true
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
        coreLibraryDesugaringEnabled true
    }
    
    kotlinOptions {
        jvmTarget = "17"
    }


    signingConfigs {
        debug {
            // Debug pakai key bawaan
            storeFile file("${rootDir}/debug.keystore")
            storePassword "android"
            keyAlias "androiddebugkey"
            keyPassword "android"
        }
        release {
            // Untuk release, ganti sesuai file keystore milikmu nanti
            storeFile file("your-release-key.jks")
            storePassword "your-store-password"
            keyAlias "your-key-alias"
            keyPassword "your-key-password"
        }
    }

    buildTypes {
    release {
        minifyEnabled false // matikan dulu biar gampang debug kalau build release
        shrinkResources false
        proguardFiles getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro"
    }
}
}

flutter {
    source = "../.."
}

// Task untuk mengganti nama APK release
tasks.register("renameApk", Copy) {
    from 'build/outputs/apk/release/app-release.apk'
    into 'build/outputs/apk/release/'
    rename { String fileName ->
        fileName.replace("app-release.apk", "bpkp_pos_test.apk")
    }
}

// Jalankan rename hanya kalau assembleRelease ada
gradle.taskGraph.whenReady { taskGraph ->
    if (taskGraph.hasTask(":app:assembleRelease")) {
        tasks.named("assembleRelease").configure {
            finalizedBy("renameApk")
        }
    }
}

dependencies {
    implementation "org.jetbrains.kotlin:kotlin-stdlib:2.2.10"

    // Desugar untuk kompatibilitas API lama
    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:2.1.4'

    // MultiDex (biar aman kalau method > 64k)
    implementation "androidx.multidex:multidex:2.0.1"
}
